<div class="main-container">
    <!-- Watch Party Section -->
    <div class="watch-party-controls" *ngIf="isAuthenticated">
        <h3 class="wp-title"><i class="bi bi-tv"></i> Watch Parties</h3>
        <div class="wp-actions">
            <div class="create-room">
                <input type="text" [(ngModel)]="newRoomName" placeholder="New Room Name" (keyup.enter)="createRoom()">
                <button class="create-btn" (click)="createRoom()">Create Room</button>
            </div>
            <div class="join-room">
                <input type="text" [(ngModel)]="joinTokenInput" placeholder="Enter Room Token"
                    (keyup.enter)="joinByToken()">
                <button class="join-btn" (click)="joinByToken()">Join</button>
            </div>
        </div>
        <div class="active-rooms" *ngIf="rooms.length > 0">
            <h4>Active Rooms</h4>
            <div class="room-list">
                <div class="room-pill" *ngFor="let room of rooms" (click)="joinRoom(room)">
                    <span class="room-pill-name">{{ room.name }}</span>
                    <span class="room-pill-meta">by {{ room.creator?.username }} • {{ room.participants_count || 0 }} <i
                            class="bi bi-people-fill"></i></span>
                </div>
            </div>
        </div>
        <div class="current-session" *ngIf="joinedRoom">
            <div class="session-info">
                <i class="bi bi-tv-fill"></i>
                <span>In Room: <strong>{{ joinedRoom.name }}</strong></span>
                <code class="session-token">{{ joinedRoom.token }}</code>
            </div>
            <div class="session-actions">
                <a class="enter-room-btn" [routerLink]="['/room', joinedRoom.id]">
                    <i class="bi bi-box-arrow-in-right"></i> Enter Room
                </a>
                <button class="leave-room-btn" (click)="leaveCurrentRoom()">
                    <i class="bi bi-x-circle"></i> Leave
                </button>
            </div>
        </div>
    </div>

    <div class="video-grid" *ngIf="videos.length > 0; else noVideos">
        <div class="video-card" *ngFor="let video of videos">
            <div class="thumbnail-wrapper" (click)="navigateToVideo(video)">
                <img [src]="video.thumbnail || 'https://via.placeholder.com/320x180'" alt="Thumbnail" class="thumbnail">
                <div class="play-overlay">
                    <i class="bi bi-play-circle-fill"></i>
                </div>
                <span class="duration">12:34</span>
            </div>
            <div class="video-details">
                <div class="avatar" (click)="navigateToProfile(video.user.id)">
                    {{ video.user.name.charAt(0) }}
                </div>
                <div class="meta">
                    <h3 class="video-title" (click)="navigateToVideo(video)">{{ video.title || 'Untitled Video' }}</h3>
                    <p class="channel-name" (click)="navigateToProfile(video.user.id)">{{ video.user.username }}</p>
                    <p class="views-date">{{ getViewsCount(video.views) }} views • {{ getTimeAgo(video.created_at) }}
                    </p>
                </div>
            </div>

            <div class="interactions">
                <button class="action-btn" (click)="toggleLike(video)" [class.active]="isLikedByMe(video)">
                    <i class="bi" [class.bi-hand-thumbs-up-fill]="isLikedByMe(video)"
                        [class.bi-hand-thumbs-up]="!isLikedByMe(video)"></i>
                    <span>{{ video.likes?.length || 0 }}</span>
                </button>
                <button class="action-btn" (click)="toggleComments(video)">
                    <i class="bi bi-chat-text"></i>
                    <span>{{ video.comments_count || 0 }}</span>
                </button>
                <button class="action-btn wp-btn" (click)="startVideoInRoom(video)"
                    *ngIf="joinedRoom && joinedRoom.creator_id === currentUserId">
                    <i class="bi bi-play-circle-fill"></i>
                    <span>Sync to Room</span>
                </button>
            </div>
            <div class="comments-section" *ngIf="visibleComments[video.id]">
                <div class="comment-input-area">
                    <input type="text" [(ngModel)]="newComments[video.id]" placeholder="Add a comment..."
                        (keyup.enter)="addComment(video)">
                    <button class="send-btn" (click)="addComment(video)">
                        <i class="bi bi-send"></i>
                    </button>
                </div>
                <div class="comments-list">
                    <div class="comment-item" *ngFor="let comment of video.comments">
                        <div class="comment-avatar" (click)="navigateToProfile(comment.user.id)">
                            {{ comment.user.name.charAt(0) }}
                        </div>
                        <div class="comment-content">
                            <p class="comment-user" (click)="navigateToProfile(comment.user.id)">{{
                                comment.user.username
                                }} <span>{{ getTimeAgo(comment.created_at) }}</span></p>
                            <p class="comment-text">{{ comment.content }}</p>
                        </div>
                    </div>
                    <div class="load-more-container"
                        *ngIf="commentPagination[video.id] && commentPagination[video.id].current_page < commentPagination[video.id].last_page">
                        <button class="load-more-btn" (click)="loadMoreComments(video)">Load more comments</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <ng-template #noVideos>
        <div class="empty-state">
            <h2>No videos found</h2>
            <p>Upload a video to get started!</p>
        </div>
    </ng-template>
</div>